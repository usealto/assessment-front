<h1 id="welcome">{{ I18ns.leadHome.title + profileStore.user.value.firstname | titlecase }}</h1>
<p class="mb-4 alto-grey fs-6b">{{ I18ns.leadHome.subtitle }}</p>
<div class="row">
  <div class="col-6">
    <div class="panel">
      <div class="d-inline-block alto-badge-big"><i class="fs-4 bi bi-chat-text"></i></div>
      <div class="d-inline-block align-bottom ms-4">
        <p
          class="fw-bold fs-6b mb-1"
          [style]="commentsCount ? 'color: var(--orange-600)' : ''"
        >
          {{ I18ns.leadHome.comments | plural : commentsCount }}
          <span *ngIf="questionsCount > 0" class="text-black">{{ I18ns.leadHome.awaiting }}</span>
        </p>
        <p class="alto-grey">
          {{ I18ns.leadHome.subtitleComment | plural : commentsCount }}
        </p>
      </div>
    </div>
  </div>
  <div class="col-6">
    <div
      class="panel cursor-pointer"
      [routerLink]="['/', AltoRoutes.lead, AltoRoutes.programs]"
      fragment="submittedQuestionsAnchor"
    >
      <div class="d-inline-block alto-badge-big"><i class="fs-4 bi bi-question-circle"></i></div>
      <div class="d-inline-block align-bottom ms-4">
        <p class="fw-bold fs-6b mb-1" [style]="questionsCount ? 'color: var(--orange-600)' : ''">
          {{ I18ns.leadHome.question | plural : questionsCount }}
          <span *ngIf="questionsCount > 0" class="text-black">{{ I18ns.leadHome.awaiting }}</span>
        </p>
        <p class="alto-grey">
          {{ I18ns.leadHome.subtitleQuestion | plural : questionsCount }}
        </p>
      </div>
    </div>
  </div>
</div>

<!-- STATISTICS -->
<div class="mt-6 mb-4">
  <div class="d-inline-block">
    <h2>
      <span class="pe-3">ðŸ“ˆ</span>
      {{ I18ns.leadHome.statistics.title }}
    </h2>
    <p class="subtitle fs-6b">{{ I18ns.leadHome.statistics.subtitle }}</p>
  </div>
  <div class="d-inline-block float-end pe-0">
    <alto-time-picker (durationSelected)="updateStatisticsDuration($event)"></alto-time-picker>
  </div>
</div>

<div class="panel px-0 py-4">
  <div class="row">
    <div class="col border-end d-flex flex-row align-items-center px-4">
      <div class="col-1 d-inline-block alto-badge-primary">
        <i class="fs-4 bi bi-bar-chart-fill"></i>
      </div>
      <div class="col ps-4">
        <p class="stats-title">{{ I18ns.leadHome.statistics.averageScore }}</p>
        <div class="mt-2 row">
          <h2 class="mb-0 col">{{ averageScore | percent }}</h2>
          <alto-progression-badge class="col-3" [score]="averageScoreProgression"></alto-progression-badge>
        </div>
      </div>
    </div>
    <div class="col border-end d-flex flex-row align-items-center px-4">
      <div class="col-1 d-inline-block alto-badge-primary">
        <i class="fs-4 bi bi-check-square-fill"></i>
      </div>
      <div class="col ps-4">
        <p class="stats-title">{{ I18ns.leadHome.statistics.terminatedPrograms }}</p>
        <div class="mt-2 row">
          <h2 class="mb-0 col">
            {{
              finishedProgramsCount + '/' + programsCount + ' (' + (averageFinishedPrograms | percent) + ')'
            }}
          </h2>
          <alto-progression-badge
            class="col-3"
            [score]="averageFinishedProgramsProgression"
          ></alto-progression-badge>
        </div>
      </div>
    </div>
    <div class="col d-flex flex-row align-items-center px-4">
      <div class="col-1 d-inline-block alto-badge-primary">
        <i class="fs-4 bi bi-reply-all-fill"></i>
      </div>
      <div class="col ps-4">
        <p class="stats-title">{{ I18ns.leadHome.statistics.guessesCount }}</p>
        <div class="mt-2 row">
          <h2 class="mb-0 col">{{ guessCount + '/' + totalGuessCount }}</h2>
          <alto-progression-badge class="col-3" [score]="guessCountProgression"></alto-progression-badge>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- CHARTS -->
<div class="panel h-100 mt-5">
  <h2>{{ I18ns.leadHome.globalEvolution.score }}</h2>
  <p class="alto-grey mb-4">{{ I18ns.leadHome.globalEvolution.chartSubtitle }}</p>
  <div [hidden]="!scoreCount" class="chart-container pt-6">
    <canvas id="programScoreEvol"></canvas>
  </div>
  <div [hidden]="scoreCount > 0" class="text-center pt-6">
    {{ I18ns.shared.noData }}
  </div>
</div>
<!-- TOP / FLOP -->
<!-- PROGRAMS & TAGS -->
<div class="panel mb-4">
  <i
    class="fs-5 alto-grey bi bi-question-circle float-end"
    ngbTooltip="{{
      I18ns.leadHome.globalEvolution.topFlopTooltip
        | replaceInTranslation : (topFlopProgramTab === 'program' ? I18ns.shared.programs : I18ns.shared.tags)
    }}"
  ></i>
  <alto-tabs
    class="mb-4"
    *ngVar="I18ns.leadHome.globalEvolution.tabs as trads"
    (tabChanged)="topFlop($event)"
    [data]="[
      { label: trads.program, value: ScoreTypeEnum.Program },
      { label: trads.tag, value: ScoreTypeEnum.Tag }
    ]"
  ></alto-tabs>
  <div class="row">
    <div class="col-6 border-end pe-0">
      <h1 class="mb-4">{{ I18ns.leadHome.globalEvolution.top }}</h1>
      <div class="height-100">
        <ng-container *ngIf="topFlopData?.programs?.top?.length; else tfProgramTemplate">
          <p *ngFor="let item of topFlopData?.programs?.top | slice : 0 : 3" class="mb-3">
            <span class="d-inline-block text-truncate topflop-label">{{ item.label }}</span>
            <span class="float-end alto-score me-4" [class]="item.avg * 100 | pillColor">
              {{ item.avg | percent }}
            </span>
          </p>
        </ng-container>
      </div>
    </div>
    <div class="col-6 ps-4 pe-0">
      <h1 class="mb-4">{{ I18ns.leadHome.globalEvolution.flop }}</h1>
      <div class="height-100">
        <ng-container *ngIf="topFlopData?.programs?.flop?.length; else tfProgramTemplate">
          <p *ngFor="let item of topFlopData?.programs?.flop | slice : 0 : 3" class="mb-3">
            <span class="d-inline-block text-truncate topflop-label">{{ item.label }}</span>
            <span class="float-end alto-score" [class]="item.avg * 100 | pillColor">
              {{ item.avg | percent }}
            </span>
          </p>
        </ng-container>
      </div>
    </div>
  </div>
</div>
<!-- TEAMS & USERS -->
<div class="panel">
  <i
    class="fs-5 alto-grey bi bi-question-circle float-end"
    ngbTooltip="{{
      I18ns.leadHome.globalEvolution.topFlopTooltip
        | replaceInTranslation : (topFlopTeamTab === 'team' ? I18ns.shared.teams : I18ns.shared.members)
    }}"
  ></i>
  <alto-tabs
    class="mb-4"
    *ngVar="I18ns.leadHome.globalEvolution.tabs as trads"
    (tabChanged)="topFlop($event)"
    [data]="[
      { label: trads.team, value: ScoreTypeEnum.Team },
      { label: trads.member, value: ScoreTypeEnum.User }
    ]"
  ></alto-tabs>
  <div class="row">
    <div class="col-6 border-end pe-0">
      <h1 class="mb-4">{{ I18ns.leadHome.globalEvolution.top }}</h1>
      <div class="height-100">
        <ng-container *ngIf="topFlopData?.teams?.top?.length; else tfProgramTemplate">
          <p *ngFor="let item of topFlopData?.teams?.top | slice : 0 : 3" class="mb-3">
            <span class="d-inline-block text-truncate topflop-label">{{ item.label }}</span>
            <span class="float-end alto-score me-4" [class]="item.avg * 100 | pillColor">
              {{ item.avg | percent }}
            </span>
          </p>
        </ng-container>
      </div>
    </div>
    <div class="col-6 ps-4 pe-0">
      <h1 class="mb-4">{{ I18ns.leadHome.globalEvolution.flop }}</h1>
      <div class="height-100">
        <ng-container *ngIf="topFlopData?.teams?.flop?.length; else tfProgramTemplate">
          <p *ngFor="let item of topFlopData?.teams?.flop" class="mb-3">
            <span class="d-inline-block text-truncate topflop-label">{{ item.label }}</span>
            <span class="float-end alto-score" [class]="item.avg * 100 | pillColor">
              {{ item.avg | percent }}
            </span>
          </p>
        </ng-container>
      </div>
    </div>
    <ng-template #tfProgramTemplate>
      <div class="text-center py-3">
        {{ I18ns.shared.noData }}
      </div>
    </ng-template>
  </div>
</div>

<!-- ONGOING PROGRAMS -->
<div class="mt-6 ongoing-programs">
  <h2 class="title">{{ I18ns.leadHome.ongoingPrograms.title }}</h2>
</div>

<alto-program-card-list [place]="'home'"></alto-program-card-list>

<!-- CHALLENGES -->
<div class="row mt-6 mb-4" hidden>
  <div class="col-5">
    <h2 class="title">{{ I18ns.leadHome.ongoingChallenges.title }}</h2>
  </div>
  <div class="col-7 text-end">
    <button [routerLink]="['/', AltoRoutes.lead, AltoRoutes.challenges]" class="btn btn-outline-secondary">
      {{ I18ns.shared.showAll }} <i class="ms-2 bi bi-arrow-right"></i>
    </button>
  </div>
</div>
<div class="row" hidden>
  <div class="col-6">
    <div class="table-panel">
      <h2>{{ I18ns.leadHome.ongoingChallenges.byTeam }}</h2>
      <hr class="m-0" />

      <ng-container *ngIf="challengesByTeam.length > 0; else noChallenges">
        <table class="table">
          <thead>
            <tr>
              <th scope="col" class="w-35">{{ I18ns.leadHome.ongoingChallenges.table.name }}</th>
              <th scope="col">{{ I18ns.leadHome.ongoingChallenges.table.leader }}</th>
              <th scope="col">{{ I18ns.leadHome.ongoingChallenges.table.teams }}</th>
              <th scope="col">{{ I18ns.leadHome.ongoingChallenges.table.end }}</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let chal of challengesByTeam"
              [routerLink]="['/', AltoRoutes.lead, AltoRoutes.challenges]"
              class="cursor-pointer"
            >
              <td class="fw-medium alto-blue fs-6">{{ chal.name }}</td>
              <td>
                <span
                  *ngIf="chal.leadTeam"
                  class="alto-badge"
                  [style.backgroundColor]="chal.leadTeam.id | uuid2color"
                  [style.color]="'white'"
                >
                  {{ chal.leadTeam.shortName }}
                </span>
              </td>
              <td>
                <alto-colored-pill-list
                  [hasDynamicColor]="true"
                  [data]="chal.teams || []"
                  [limit]="2"
                ></alto-colored-pill-list>
              </td>
              <td>{{ chal.endDate | date : 'shortDate' }}</td>
            </tr>
          </tbody>
        </table>
      </ng-container>
      <ng-template #noChallenges>
        <div class="panel text-center">
          <i class="bi bi-controller fs-5"></i>
          <h2>{{ I18ns.leadHome.ongoingChallenges.noTeamChallenges }}</h2>
          <p>{{ I18ns.leadHome.ongoingChallenges.noTeamChallengesSubtitle }}</p>
        </div>
      </ng-template>

      <p class="text-end">
        <a
          [routerLink]="['/', AltoRoutes.lead, AltoRoutes.challenges]"
          [fragment]="'byTeamAnchor'"
          class="fw-medium mb-4 me-4 d-block"
        >
          {{ I18ns.shared.showMore }}
        </a>
      </p>
    </div>
  </div>

  <div class="col-6">
    <div class="table-panel">
      <h2>{{ I18ns.leadHome.ongoingChallenges.individual }}</h2>
      <hr class="m-0" />

      <ng-container *ngIf="challengesByUser.length > 0; else noChallenges">
        <table class="table">
          <thead>
            <tr>
              <th scope="col" class="w-35">{{ I18ns.leadHome.ongoingChallenges.table.name }}</th>
              <th scope="col">{{ I18ns.leadHome.ongoingChallenges.table.leader }}</th>
              <th scope="col">{{ I18ns.leadHome.ongoingChallenges.table.teams }}</th>
              <th scope="col">{{ I18ns.leadHome.ongoingChallenges.table.end }}</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let chal of challengesByUser"
              [routerLink]="['/', AltoRoutes.lead, AltoRoutes.challenges]"
              class="cursor-pointer"
            >
              <td class="fw-medium alto-blue fs-6">{{ chal.name }}</td>
              <td>
                <alto-img-badge [user]="getUser(chal.createdBy) | async"></alto-img-badge>
              </td>
              <td>
                <alto-colored-pill-list
                  [hasDynamicColor]="true"
                  [data]="chal.teams || []"
                  [limit]="2"
                ></alto-colored-pill-list>
              </td>
              <td>{{ chal.endDate | date : 'shortDate' }}</td>
            </tr>
          </tbody>
        </table>
      </ng-container>
      <ng-template #noChallenges>
        <div class="panel text-center">
          <i class="bi bi-controller fs-5"></i>
          <h2>{{ I18ns.leadHome.ongoingChallenges.noTeamChallenges }}</h2>
          <p>{{ I18ns.leadHome.ongoingChallenges.noTeamChallengesSubtitle }}</p>
        </div>
      </ng-template>

      <p class="text-end">
        <a
          [routerLink]="['/', AltoRoutes.lead, AltoRoutes.challenges]"
          [fragment]="'byUserAnchor'"
          class="fw-medium mb-4 me-4 d-block"
        >
          {{ I18ns.shared.showMore }}
        </a>
      </p>
    </div>
  </div>
</div>
