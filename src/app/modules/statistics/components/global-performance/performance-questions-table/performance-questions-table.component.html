<div class="mb-4 d-flex justify-content-between">
  <alto-input-search [searchControl]="questionSearchControl"></alto-input-search>

  <alto-input-single-select-pill
    [title]="I18ns.statistics.user.performance.questions.scoreFilter"
    [control]="scoreControl"
    [options]="scoreOptions"
  ></alto-input-single-select-pill>
</div>

<alto-placeholder-manager [status]="questionsDataStatus">
  <div *ngIf="questionsDataStatus === 'good'" class="table-panel">
    <table class="table">
      <thead>
        <tr>
          <th scope="col" class="w-35">
            {{ I18ns.statistics.globalPerformance.questionsTable.columns.question }}
          </th>
          <th scope="col" class="w-10 text-center">
            {{ I18ns.statistics.globalPerformance.questionsTable.columns.globalScore }}
          </th>
          <th scope="col" class="w-10 text-center">
            {{ I18ns.statistics.globalPerformance.questionsTable.columns.scoreEvolution }}
          </th>
          <th scope="col" class="w-20 text-center">
            {{ I18ns.statistics.globalPerformance.questionsTable.columns.usersNumber }}
          </th>
          <th scope="col" class="w-25">
            {{ I18ns.statistics.globalPerformance.questionsTable.columns.badTeams }}
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let quest of questionsDisplay" class="align-middle">
          <td>
            {{ quest.question.title | sliceWithDots : 150 }}
          </td>
          <td class="text-center">
            <ng-container *ngIf="quest.score; else elseTemplate">
              <span class="alto-score" [class]="(quest.score || 0) * 100 | pillColor">{{
                quest.score | percent
              }}</span>
            </ng-container>
            <ng-template #elseTemplate>
              <p class="alto-grey text-center">
                {{ I18ns.statistics.globalPerformance.questionsTable.columns.noScore }}
              </p>
            </ng-template>
          </td>
          <td class="text-center">
            <alto-progression-badge
              class="d-inline-block ms-3"
              [score]="getQuestionPreviousScore(quest)"
              *ngIf="getQuestionPreviousScore(quest) !== 0; else noScoreEvolution"
            ></alto-progression-badge>
            <ng-template #noScoreEvolution>
              <p class="alto-grey text-center">
                {{ I18ns.statistics.globalPerformance.questionsTable.columns.noScoreEvolution }}
              </p>
            </ng-template>
          </td>
          <td class="text-center">
            <!-- todo when api is ready -->
            <!-- <div class="progress">
            <div
              class="progress-bar d-inline-block"
              role="progressbar"
              [style]="'width:' + (quest.usersCount / quest.totalUsersCount | percent : '1.0-0' : 'en-US')"
            ></div>
          </div> -->
            <!-- {{ quest.usersCount }}/{{ quest.totalUsersCount }} -->
            <span *ngIf="quest.usersCount > 0; else noUsersCount">
              {{ quest.usersCount }}
            </span>
            <ng-template #noUsersCount>
              <p class="alto-grey text-center">
                {{ I18ns.statistics.globalPerformance.questionsTable.columns.noUsersCount }}
              </p>
            </ng-template>
          </td>
          <td>
            <ng-container *ngIf="quest.teams && getBadTeams(quest.teams).length > 0; else noBadTeam">
              <alto-colored-pill-list
                [hasDynamicColor]="true"
                [limit]="3"
                [textLimit]="15"
                [data]="getBadTeams(quest.teams)"
              ></alto-colored-pill-list>
            </ng-container>
            <ng-template #noBadTeam>
              <p class="alto-grey text-start">
                {{ I18ns.statistics.globalPerformance.questionsTable.columns.noBadTeams }}
              </p>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
    <alto-pagination
      class="mx-4 d-block"
      [pageControl]="questionsPageControl"
      [itemsCount]="questions.length"
      [itemsPerPage]="questionsPageSize"
    ></alto-pagination>
  </div>

  <div class="col nodata-placeholder d-flex justify-content-center align-items-center" noData>
    <div class="text-center">
      <img [src]="Emoji.Collision | emoji" height="24" width="24" />
      <p class="mt-3">{{ I18ns.statistics.globalPerformance.questionsTable.placeholder }}</p>
    </div>
  </div>
  <div class="skeleton-panel mt-5" style="height: 266px" loading></div>
</alto-placeholder-manager>
