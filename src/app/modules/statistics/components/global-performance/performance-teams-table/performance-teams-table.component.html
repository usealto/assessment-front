<div class="row mb-4">
  <div class="col-8">
    <alto-dropdown-filter
      class="text-start"
      [data]="teams"
      [displayLabel]="'label'"
      [returnValue]="'id'"
      [placeholder]="I18ns.programs.programs.filters.team"
      [isColored]="true"
      (selectChange)="getTeamsFiltered({ teams: $event })"
      class="me-3"
    ></alto-dropdown-filter>
    <alto-dropdown-filter
      class="me-3"
      [data]="programs"
      [displayLabel]="'label'"
      [returnValue]="'id'"
      [placeholder]="I18ns.programs.questions.filters.programs"
      (selectChange)="getTeamsFiltered({ programs: $event })"
    ></alto-dropdown-filter>
    <alto-dropdown-filter
      class="me-3"
      [data]="tags"
      [returnValue]="'id'"
      [displayLabel]="'label'"
      [placeholder]="I18ns.programs.questions.filters.tags"
      (selectChange)="getTeamsFiltered({ tags: $event })"
    ></alto-dropdown-filter>
  </div>
  <div class="col-4 text-end">
    <!-- <alto-search (searchChange)="getTeamsFiltered({ search: $event })"></alto-search> -->
  </div>
</div>

<div class="table-panel">
  <table class="table">
    <thead>
      <tr>
        <th scope="col" class="w-20">{{ I18ns.statistics.globalPerformance.teamsTable.columns.name }}</th>
        <th scope="col" class="w-15 text-center">
          {{ I18ns.statistics.globalPerformance.teamsTable.columns.global }}
          <i
            class="ms-2 alto-grey bi bi-question-circle"
            ngbTooltip="{{ I18ns.statistics.perTeams.globalTooltip }}"
          ></i>
        </th>
        <th scope="col" class="w-35">
          {{ I18ns.statistics.globalPerformance.teamsTable.columns.lessMasteredPrograms }}
        </th>
        <th scope="col" class="w-30">
          {{ I18ns.statistics.globalPerformance.teamsTable.columns.lessMasteredTags }}
        </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let team of paginatedTeams" class="align-middle">
        <td class="fw-medium alto-text-color">
          {{ team.label }}
        </td>
        <td class="text-center">
          {{ team.score + ' %' }}
          <alto-progression-badge
            class="d-inline-block ms-3"
            [score]="getTeamPreviousScore(team)"
            *ngIf="!scoreIsLoading"
          ></alto-progression-badge>
        </td>
        <td>
          <ng-template #programsTooltip>
            <ng-container *ngFor="let prog of team.programs">{{ prog.label }}<br /></ng-container>
          </ng-template>

          <div class="text-nowrap overflow-hidden" [ngbTooltip]="programsTooltip">
            <!-- <span
              *ngFor="let prg of team.programs || [] | slice : 0 : 3 | sort : 'asc' : 'score'"
              class="alto-badge me-2"
            >
              {{ prg.label }}
            </span> -->
            <ng-container *ngIf="team.programs">
              <td>
                <alto-colored-pill-list
                  [data]="team.programs | sort : 'asc' : 'score'"
                  [limit]="3"
                ></alto-colored-pill-list>
              </td>
            </ng-container>
          </div>
        </td>
        <td>
          <ng-template #tagsTooltip>
            <ng-container *ngFor="let tag of team.tags">{{ tag.label }}<br /></ng-container>
          </ng-template>

          <div class="text-nowrap overflow-hidden" [ngbTooltip]="tagsTooltip">
            <!-- <span
              *ngFor="let tg of team.tags || [] | slice : 0 : 3 | sort : 'asc' : 'score'"
              class="alto-badge me-2"
              {{ tg.label }}
              </span>
            > -->
            <ng-container *ngIf="team.tags">
              <td>
                <alto-colored-pill-list
                  [data]="team.tags | sort : 'asc' : 'score'"
                  [limit]="3"
                ></alto-colored-pill-list>
              </td>
            </ng-container>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
  <alto-pagination
    class="mx-4 d-block"
    [collectionSize]="teams.length"
    (pageChange)="changeTeamsPage($event)"
    [pageSize]="teamsPageSize"
    [maxSize]="5"
    [page]="teamsPage"
  ></alto-pagination>
</div>
