<div class="row mb-4">
  <div class="col-4">
    <alto-search (searchChange)="getTeamsFiltered({ search: $event })"></alto-search>
  </div>
  <div class="col-8 text-end">
    <!-- <alto-dropdown-filter
      class="text-start"
      [data]="getTeamsDropdown(teamsDisplay.length)"
      [displayLabel]="'longName'"
      [returnValue]="'id'"
      [placeholder]="I18ns.programs.programs.filters.team"
      [isColored]="true"
      (selectChange)="getTeamsFiltered({ teams: $event })"
      class="me-3"
    ></alto-dropdown-filter> -->
    <alto-dropdown-filter
      class="me-3 text-start"
      [data]="programs"
      [displayLabel]="'name'"
      [returnValue]="'id'"
      [placeholder]="I18ns.programs.questions.filters.programs"
      (selectChange)="getTeamsFiltered({ programs: $event })"
    ></alto-dropdown-filter>
    <alto-dropdown-filter
      class="text-start"
      [data]="tags"
      [returnValue]="'id'"
      [displayLabel]="'name'"
      [placeholder]="I18ns.programs.questions.filters.tags"
      (selectChange)="getTeamsFiltered({ tags: $event })"
    ></alto-dropdown-filter>
  </div>
</div>

<alto-placeholder-manager [status]="teamsDataStatus">
  <div class="table-panel">
    <table class="table">
      <thead>
        <tr>
          <th scope="col" class="w-20">{{ I18ns.statistics.globalPerformance.teamsTable.columns.team }}</th>
          <th scope="col" class="w-10 text-center">
            {{ I18ns.statistics.globalPerformance.teamsTable.columns.globalScore }}
          </th>
          <th scope="col" class="w-15 text-center">
            {{ I18ns.statistics.globalPerformance.teamsTable.columns.scoreEvolution }}
          </th>
          <th scope="col" class="w-35">
            {{ I18ns.statistics.globalPerformance.teamsTable.columns.lessMasteredPrograms }}
          </th>
          <th scope="col" class="w-30">
            {{ I18ns.statistics.globalPerformance.teamsTable.columns.lessMasteredTags }}
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let team of paginatedTeams" class="align-middle">
          <td>
            <span class="alto-badge" [style]="team.team.id | teamColor">{{ team.team.name }}</span>
          </td>
          <td class="text-center">
            <ng-container *ngIf="team.score; else elseTemplate">
              <span class="alto-score" [class]="(team.score || 0) * 100 | pillColor">{{
                team.score | percent
              }}</span>
            </ng-container>
            <ng-template #elseTemplate>
              <span class="alto-score" [class]="0 | pillColor">
                {{ I18ns.shared.noDataInt }}
              </span>
            </ng-template>
          </td>
          <td class="text-center">
            <alto-progression-badge
              class="d-inline-block"
              [score]="getTeamPreviousScore(team)"
              *ngIf="!scoreIsLoading"
            ></alto-progression-badge>
          </td>
          <td>
            <!-- <ng-template #programsTooltip>
                <ng-container *ngFor="let prog of team.programs">{{ prog.label }}<br /></ng-container>
              </ng-template>-->

            <ng-container *ngIf="team.programs">
              <alto-colored-pill-list
                [textLimit]="15"
                [data]="team.programs || [] | sort : 'asc' : 'score' | slice : 0 : 3"
              ></alto-colored-pill-list>
            </ng-container>
          </td>
          <td>
            <!-- <ng-template #tagsTooltip>
                <ng-container *ngFor="let tag of team.tags">{{ tag.label }}<br /></ng-container>
              </ng-template>-->

            <ng-container *ngIf="team.tags">
              <alto-colored-pill-list
                [textLimit]="15"
                [data]="team.tags | sort : 'asc' : 'score' | slice : 0 : 3"
              ></alto-colored-pill-list>
            </ng-container>
          </td>
        </tr>
      </tbody>
    </table>
    <alto-pagination
      class="mx-4 d-block"
      [collectionSize]="teamsDisplay.length"
      (pageChange)="changeTeamsPage($event)"
      [pageSize]="teamsPageSize"
      [page]="teamsPage"
    ></alto-pagination>
  </div>

  <div class="col nodata-placeholder d-flex justify-content-center align-items-center" noData>
    <div class="text-center">
      <img [src]="Emoji.Eyes | emoji" height="24" />
      <p class="mt-3">{{ I18ns.statistics.globalPerformance.teamsTable.placeholder }}</p>
    </div>
  </div>
  <div class="skeleton-panel mt-5" style="height: 266px" loading></div>
</alto-placeholder-manager>
